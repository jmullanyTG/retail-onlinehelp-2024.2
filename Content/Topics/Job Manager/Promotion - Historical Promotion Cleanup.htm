<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <link href="../../Resources/TableStyles/standard.css" rel="stylesheet" MadCap:stylesheetType="table" />
    </head>
    <body>
        <h1>Promotion - Historical Promotion Cleanup</h1>
        <p>Customers generate large amounts of Promotion related data that need to be deleted to maintain database size. The Promotion Purge process deletes Promotion information marked as <span class="Emphasis">Deleted</span> from the user interface (UI) (i.e. <span class="Emphasis">tbl_Promotion.DeleteFlag=1</span>). </p>
        <p>It is highly recommended to test the purge process with a low number of Promotions and ramp up as hardware allows. Running the Promotion purge process, with a high number of Promotions, will result in a large number of rows being deleted which will require a large time frame to complete.</p>
        <p class="BasicNote">Only 'soft' deleted (DeleteFlag=1) Promotions will be purged.</p>
        <h2>Task parameters</h2>
        <table style="width: 100%;margin-left: auto;margin-right: auto;mc-table-style: url('../../Resources/TableStyles/standard.css');" class="TableStyle-standard" cellspacing="0">
            <col class="TableStyle-standard-Column-Column1" />
            <col class="TableStyle-standard-Column-Column2" />
            <thead>
                <tr class="TableStyle-standard-Head-Header1">
                    <th class="TableStyle-standard-HeadE-Column1-Header1">Parameter</th>
                    <th class="TableStyle-standard-HeadD-Column2-Header1">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyE-Column1-Body1"><span class="Emphasis">Task Type</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column2-Body1">SQL Stored Procedure Task</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyE-Column1-Body1"><span class="Emphasis">Name</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column2-Body1">Promotion - Historical Promotion Cleanup</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyE-Column1-Body1"><span class="Emphasis">Description</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column2-Body1">This task deletes promotion information marked as <span class="Emphasis">Deleted </span>from the UI.</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyE-Column1-Body1"><span class="Emphasis">Progress Type</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column2-Body1">Report error and continue</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyE-Column1-Body1"><span class="Emphasis">Time Out (Seconds)</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column2-Body1">43,200 seconds</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyE-Column1-Body1"><span class="Emphasis">Retry Count</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column2-Body1">0</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyE-Column1-Body1"><span class="Emphasis">Retry Interval (ms)</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column2-Body1">10,000</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyE-Column1-Body1"><span class="Emphasis">Task Enabled</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column2-Body1">De-selected</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyE-Column1-Body1"><span class="Emphasis">Transaction Mode</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column2-Body1">Non-transactional</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyE-Column1-Body1"><span class="Emphasis">SQL Connection Type</span>
                    </td>
                    <td class="TableStyle-standard-BodyD-Column2-Body1">Operations database</td>
                </tr>
                <tr class="TableStyle-standard-Body-Body1">
                    <td class="TableStyle-standard-BodyB-Column1-Body1"><span class="Emphasis">Method</span>
                    </td>
                    <td class="TableStyle-standard-BodyA-Column2-Body1" style="padding: 0px;">
                        <table style="width: 100%;margin-left: auto;margin-right: auto;mc-table-style: url('../../Resources/TableStyles/standard.css');" class="TableStyle-standard" cellspacing="0">
                            <col class="TableStyle-standard-Column-Column1" />
                            <col class="TableStyle-standard-Column-Column2" />
                            <tbody>
                                <tr class="TableStyle-standard-Body-Body1">
                                    <td class="TableStyle-standard-BodyE-Column1-Body1">@iUserID = 1 (Default)</td>
                                    <td class="TableStyle-standard-BodyD-Column2-Body1">
                                        The user ID executing the purge. This value must be set to <span class="Emphasis">1</span>, unless a maintenance user ID has been created with the appropriate database permissions. 
                                    </td>
                                </tr>
                                <tr class="TableStyle-standard-Body-Body1">
                                    <td class="TableStyle-standard-BodyE-Column1-Body1">@PromotionLimit
(Optional)
</td>
                                    <td class="TableStyle-standard-BodyD-Column2-Body1">
                                        The number of promotions, marked as <span class="Emphasis">Deleted</span>, to be permanently removed from the database. 
                                        <p>Refer to the <span class="Emphasis">Promotions Purge User Guide</span> for guidance overriding this value. The utility adheres to the System Policy maximum, which can be raised at will. </p></td>
                                </tr>
                                <tr class="TableStyle-standard-Body-Body1">
                                    <td class="TableStyle-standard-BodyE-Column1-Body1">@RunDurationLimitMinutes
(Optional)
</td>
                                    <td class="TableStyle-standard-BodyD-Column2-Body1">Refer to the <span class="Emphasis">Promotions Purge User Guide</span> for detailed information on this and the succeeding parameter.</td>
                                </tr>
                                <tr class="TableStyle-standard-Body-Body1">
                                    <td class="TableStyle-standard-BodyE-Column1-Body1">@RunCessationDateTime
(Optional)
</td>
                                    <td class="TableStyle-standard-BodyD-Column2-Body1">See immediately above.</td>
                                </tr>
                                <tr class="TableStyle-standard-Body-Body1">
                                    <td class="TableStyle-standard-BodyB-Column1-Body1">
                                       @bDebug (Optional) 
                                    </td>
                                    <td class="TableStyle-standard-BodyA-Column2-Body1">
                                       Refer to the <span class="Emphasis">Promotions Purge User Guide</span>. 
                                        <p class="BasicNote">Under normal circumstances, NULL this parameter, it is optional.</p></td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
            </tbody>
        </table>
        <h2>Task schedule</h2>
        <p>The task must run:</p>
        <ul>
            <li>after the Historical Sales History by Type Cleanup</li>
            <li>as part of the weekly maintenance</li>
        </ul>
        <p>Normally, the task runs outside the user's regular work hours, but is designed such that it will not interfere with regular operations should the need arise to elongate the duration, especially for the initial set of Promotions to purge, which could be high in number.</p>
        <p>Any promotion-oriented Table Triggers MUST reference CONTEXT_INFO to ensure the logic does not fire – the utility sets the CONTEXT_INFO explicitly to render trigger logic inoperative.</p>
        <h2>Data elements to be purged</h2>
        <p>Data elements to be purged must include, but is not limited to:</p>
        <ul>
            <li>
                <p>Promotion</p>
                <ul>
                    <li>Groups (Promotion and Item Masters)</li>
                    <li>Content</li>
                    <li>Message Log</li>
                    <li>Price Cluster</li>
                    <li>Price Cluster Site</li>
                    <li>Output</li>
                    <li>Change Logs</li>
                    <li>Validation Logs</li>
                    <li>etc. (e.g. any table with a PromotionID field)</li>
                </ul>
            </li>
        </ul>
    </body>
</html>